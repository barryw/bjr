name: Ruby

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest
    
    steps:
    - uses: mirromutth/mysql-action@v1.1
      with:
        host port: 3307 # Optional, default value is 3306. The port of host
        container port: 3307 # Optional, default value is 3306. The port of container
        mysql version: '8.0' # Optional, default value is "latest". The version of the MySQL
        mysql database: 'bjr_test' # Optional, default value is "test". The specified database which will be create
        mysql user: 'bjr' # Required if "mysql root password" is empty, default is empty. The superuser for the specified database. Of course you can use secrets, too
        mysql password: 'bjr' # Required if "mysql user" exists. The password for the "mysql user"
    - uses: actions/checkout@v1
    - name: Set up Ruby 2.6
      uses: actions/setup-ruby@v1
      with:
        ruby-version: 2.6.3
    - name: Build and test with Rake
      env:
        BJR_DATABASE_PORT: "3307"
      run: |
        sudo apt-get install -y libmysqlclient-dev
        gem install bundler
        bundle install --jobs 4 --retry 3
        bundle exec rspec
